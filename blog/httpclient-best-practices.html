<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2MN7C3CEX2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-2MN7C3CEX2');
    </script>
    <title>Stefan Đokić</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.png">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description"
        content="The personal website of Stefan Djokic, featuring information about his background, experience, and interests.">
    <meta name="keywords" content="Stefan Djokic, personal website, bio, background, experience, interests">
    <meta name="author" content="Stefan Djokic">
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link rel="stylesheet" href="/css/animate.css">
    <link rel="stylesheet" href="/css/flaticon.css">
    <link rel="stylesheet" href="/css/icomoon.css">
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar ftco-navbar-light site-navbar-target" id="ftco-navbar">
        <div class="container">
            <a class="navbar-brand" href="/">Stefan Đokić</a>
            <button class="navbar-toggler js-fh5co-nav-toggle fh5co-nav-toggle" type="button" data-toggle="collapse"
                data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="oi oi-menu"></span> Menu
            </button>
            <div class="collapse navbar-collapse" id="ftco-nav">
                <ul class="navbar-nav nav ml-auto">
                    <li class="nav-item"><a href="/" class="nav-link"><span>Home</span></a></li>
                    <li class="nav-item" data-toggle="collapse" data-target="#ftco-nav"><a href="/blog.html"
                            class="nav-link"><span>Blog</span></a></li>
                    <li class="nav-item" data-toggle="collapse" data-target="#ftco-nav"><a
                            href="/stefans-newsletter-sponsorship-opportunity.html"
                            class="nav-link"><span>Sponsorship</span></a></li>

                </ul>
            </div>
        </div>
    </nav>
    <section class="ftco-about img ftco-section ftco-no-pb" id="social-proof" style="margin-top: 50px;">
        <div class="container">
            <div class="justify-content-center pb-5">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 heading-section text-center ">
                    <h2 class="blog-header">#17 Stefan's Newsletter</h2>
                    <h2 class="blog-header2">HttpClient Best Practices</h2>
                    <h6>June 05 2023</h6>
                </div>
            </div>
            <div class="container d-flex">
                <div class="col-sm-12 col-md-12 col-lg-12 pb-5 blog-content">
                    <h5>
                        <b>Many thanks to the sponsors who make it possible for this newsletter to be free for
                            readers.</b>
                    </h5> <br>
                    <h5>
                        Today's issue is sponsored by <a href="https://www.milanjovanovic.tech/?utm_source=stefan"
                            target="_blank"> Milan's .NET Weekly</a>
                    </h5> <br>
                    <h5>
                        Milan's .NET Weekly is a newsletter about the best practices with .NET & software architecture.
                        More than 22,000+ engineers get one practical tip every week to improve their skills.

                        Join here: <a href="https://www.milanjovanovic.tech/?utm_source=stefan"
                            target="_blank">https://www.milanjovanovic.tech</a>.
                    </h5> <br>
                    <hr style="background-color: white;">
                    <h3 class="text-center mb-5" style="color: #ffbd39">Understanding HttpClient</h3>
                    <h5>
                        The <b>HttpClient</b> class provides a base class for sending HTTP requests and receiving
                        responses from a resource identified by a URI. This is often the go-to choice when calling
                        RESTful APIs in .NET.
                    </h5> <br>
                    <h5>
                        However, using HttpClient isn't as straightforward as it may seem.
                    </h5> <br>
                    <h5>
                        You might be tempted to instantiate a new HttpClient for each request like so:
                    </h5> <br>
                    <img src="/images/blog/newsletter17/1.png"
                        style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                    <h5>
                        Unfortunately, this approach has significant downsides:
                    </h5><br>
                    <h5>
                        <b>Socket Exhaustion:</b>
                    </h5><br>
                    <h5>
                        Each HttpClient instance has its pool of sockets. Creating new instances for each request could
                        exhaust the available sockets.
                    </h5><br>
                    <h5>
                        <b>Stale DNS Entries:
                        </b>
                    </h5><br>
                    <h5>
                        HttpClient instances cache DNS entries. If the IP address of a service changes, HttpClient might
                        still point to the old address.</h5><br>
                    <h3 class="text-center mb-5" style="color: #ffbd39">HttpClientFactory: The Preferred Approach</h3>
                    <h5>HttpClientFactory is designed to manage HttpClient instances, solving problems of socket
                        exhaustion and providing better resource management.
                    </h5>
                    <br>
                    <h5>By default, it creates HttpClient instances as Transient, but with a key difference: it reuses
                        the underlying HttpMessageHandler, which manages the HTTP connections, effectively giving you
                        <b>the benefits of a Singleton HttpClient</b> (connection pooling) without its drawbacks (DNS
                        changes not respected).<br>
                        <img src="/images/blog/newsletter17/2.png"
                            style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                        <h5>
                            Then you would inject IHttpClientFactory into the constructor of the class where you want to
                            use HttpClient.
                        </h5>
                        <img src="/images/blog/newsletter17/3.png"
                            style="margin-top: 10px; margin-bottom: 10px; width: 100%;"><br>
                        <h5>
                            This setup ensures that HttpClient instances are properly managed and reused, avoiding
                            common pitfalls such as socket exhaustion and stale DNS entries.</h5><br>
                        <h3 class="text-center mb-5" style="color: #ffbd39">Named Clients: For Distinct Configurations
                        </h3>
                        <h5>In situations where your application communicates with <b> multiple external services</b>,
                            you can use <b>"Named Clients"</b> - these are pre-configured HttpClient instances
                            associated with a string-based name. This allows for separate configurations (e.g., base
                            address, default headers) for different services.</h5>
                        <br>
                        <img src="/images/blog/newsletter17/4.png"
                            style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                        <h5>
                            Using:
                        </h5>
                        <img src="/images/blog/newsletter17/5.png"
                            style="margin-top: 10px; margin-bottom: 10px; width: 100%;"><br>
                        <h5><b>Advantages of using Named Clients:</b></h5><br>
                        <h5><b>1. Multiple Configurations:
                            </b></h5><br>
                        <h5>Named clients allow for separate configurations for different HttpClients. For example, if
                            your application communicates with different APIs that need different base addresses,
                            headers, or other settings, named clients are the perfect solution.</h5>
                        <br>
                        <h5><b>2. Improved Readability:
                            </b></h5>
                        <br>
                        <h5>By naming the different configurations, the code becomes more readable, and it's easier to
                            understand which configuration is being used.
                        </h5>
                        <br>
                        <h5><b>When to avoid Named Clients:
                            </b></h5>
                        <h5>If your application only communicates with a single endpoint, or all your HttpClient
                            instances share the same configuration, named clients won't provide any advantages and will
                            just add unnecessary complexity.</h5>
                            <br>
                      
                        <h3 class="text-center mb-5" style="color: #ffbd39">Typed Clients: For Encapsulation and Testability</h3>
                        <h5>Typed clients offer another level of abstraction. They encapsulate all interactions with the HttpClient within a class. This class is then injected wherever you need to perform HTTP requests, simplifying the code and making it easier to test.</h5>
                        <br>
                        <img src="/images/blog/newsletter17/6.png"
                            style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                        <h5>
                            Using:
                        </h5>
                        <img src="/images/blog/newsletter17/7.png"
                            style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                            <h5><b>Advantages of using Named Clients:</b></h5><br>
                            <h5><b>1. Encapsulation:
                                </b></h5><br>
                            <h5>By wrapping all interactions with HttpClient in a class, you can encapsulate all the complexity and just expose the methods that your application requires.
                            </h5>
                            <br>
                            <h5><b>2. Easier Testing:
                                </b></h5>
                            <br>
                            <h5>By encapsulating the HttpClient usage in a class, it's easier to mock that class in your unit tests, improving testability.
                            </h5>
                            <br>
                            <h5><b>When to avoid Named Clients:
                                </b></h5>
                            <h5>If your HttpClient usage is straightforward and doesn't involve complex logic, or if you prefer to have the HttpClient code directly in your services or controllers rather than in a separate class, you may not need to use typed clients.</h5>
                                <br>
                        <h3 class="text-center mb-5" style="color: #ffbd39">Key Takeaways</h3>
                        <h5>1. Avoid creating new HttpClient instances manually for each request.<br>
                            2. Leverage HttpClientFactory for managing HttpClient instances.<br>
                            3. Use dependency injection to handle the lifecycle of HttpClient instances.<br>
                            4. Consider using named clients when dealing with multiple services with differing configurations.<br>
                            5. Consider typed clients to encapsulate HttpClient interactions, improving code readability and testability.
                            <br> 6. Always handle exceptions that HttpClient can throw.
                            <br>7. Use Polly for Resilience</h5>
                        <br>
                        <h5>Choosing the right approach always depends on your specific use case, and each approach has its pros and cons. Always aim for maintainability, readability, and robustness when making your decision.<br>
<br>
                        <h3 class="text-center mb-5 mt-5" style="color: #ffbd39;margin-top: -40px;">What Next?</h3>
                        <h5>
                            HttpClient provides a powerful interface for sending HTTP requests and receiving responses. Using it with dependency injection allows for better control over its lifetime and usage. HttpClientFactory provides a flexible and optimized way to handle HttpClient instances, mitigating common problems such as socket exhaustion.
                        </h5>
                        <br>
                        <h5>
                            That's all from me for today. </h5>
                        <br>
                        <h3 class="text-center"><b>Dream <span style="font-size: 50px;">big!</span></b></h3>
                        <div class="row" style="margin-top: 50px">
                            <div class="col-md-3"></div>
                            <div class="col-md-6 text-center">
                                <h5 style="text-align: center; ">
                                    Join the 4800+ engineers who get tips like this <span style="color: #ffbd39;">every
                                        Monday</span> straight to their inbox.
                                </h5>
                                <script async src="https://eocampaign1.com/form/33e483be-a0b1-11ed-b1bd-9b9d338510f2.js"
                                    data-form="33e483be-a0b1-11ed-b1bd-9b9d338510f2"></script>
                            </div>
                        </div>

                </div>
            </div>
        </div>
    </section>

    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.waypoints.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/main.js"></script>

</body>

</html>