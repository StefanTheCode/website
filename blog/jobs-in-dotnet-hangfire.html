<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2MN7C3CEX2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-2MN7C3CEX2');
    </script>
    <title>Stefan Đokić</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.png">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description"
        content="The personal website of Stefan Djokic, featuring information about his background, experience, and interests.">
    <meta name="keywords" content="Stefan Djokic, personal website, bio, background, experience, interests">
    <meta name="author" content="Stefan Djokic">
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link rel="stylesheet" href="/css/animate.css">
    <link rel="stylesheet" href="/css/flaticon.css">
    <link rel="stylesheet" href="/css/icomoon.css">
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar ftco-navbar-light site-navbar-target" id="ftco-navbar">
        <div class="container">
            <a class="navbar-brand" href="/">Stefan Đokić</a>
            <button class="navbar-toggler js-fh5co-nav-toggle fh5co-nav-toggle" type="button" data-toggle="collapse"
                data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="oi oi-menu"></span> Menu
            </button>
            <div class="collapse navbar-collapse" id="ftco-nav">
                <ul class="navbar-nav nav ml-auto">
                    <li class="nav-item"><a href="/" class="nav-link"><span>Home</span></a></li>
                    <li class="nav-item" data-toggle="collapse" data-target="#ftco-nav"><a href="/blog.html"
                            class="nav-link"><span>Blog</span></a></li>
                    <li class="nav-item" data-toggle="collapse" data-target="#ftco-nav"><a
                            href="/stefans-newsletter-sponsorship-opportunity.html"
                            class="nav-link"><span>Sponsorship</span></a></li>

                </ul>
            </div>
        </div>
    </nav>
    <section class="ftco-about img ftco-section ftco-no-pb" id="social-proof" style="margin-top: 50px;">
        <div class="container">
            <div class="justify-content-center pb-5">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 heading-section text-center ">
                    <h2 class="blog-header">#10 Stefan's Newsletter</h2>
                    <h2 class="blog-header2">Jobs in .NET with Hangfire</h2>
                    <h6>April 17 2023</h6>
                </div>
            </div>
            <div class="container d-flex">
                <div class="col-sm-12 col-md-12 col-lg-12 pb-5 blog-content">
                    <h3 class="text-center mb-5" style="color: #ffbd39">What is Hangfire and how it's working?</h3>
                    <h5>Hangfire is an open-source library for .NET that provides a simple way to perform background
                        processing in your application. It allows you to run jobs (methods or functions) asynchronously
                        and schedule them to run at a specific time or regularly.
                    </h5> <br>
                    <h5>
                        There are 3 main components of Hangfire architecture:
                    </h5> <br>
                    <h5>
                        1. Client
                    </h5> <br>
                    <h5>
                        This is the code in your application that enqueues background jobs and schedules them to run at
                        a specific time or on a recurring basis. The client API provides a simple way to create and
                        manage background jobs from within your code.
                    </h5> <br>
                    <h5>
                        2. Server
                    </h5> <br>
                    <h5>
                        This is a background process that runs continuously and is responsible for executing scheduled
                        and queued jobs. It listens to the job storage and picks up new jobs as they become available.
                    </h5> <br>
                    <h5>
                        3. Storage
                    </h5> <br>
                    <h5>
                        Hangfire provides a database to store all the information related to background jobs, including
                        their definitions, execution status, and more. Hangfire creates a couple of designated tables in
                        the database to manage this information.
                    </h5> <br>
                    <h5>
                        By default, it uses SQL Server, but any other supported option is also easy to configure.
                    </h5> <br>
                    <h5>
                        Here is the Hangfire workflow.
                    </h5>
                    <img src="/images/blog/newsletter10/hangfire-flow.png"
                        style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                    <br>
                    <h3 class="text-center mb-5 mt-5" style="color: #ffbd39">Setting up Hangfire
                    </h3>
                    <h4><b>NuGet Package:</b></h4>
                    <br>
                    <h5>You need to install Hangfire package.
                    </h5>
                    <img src="/images/blog/newsletter10/nuget-package.jpg"
                        style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                    <h5>
                        The last version is 1.7.34.
                    </h5><br>
                    <h5>
                        Hangfire.SqlServer and Hangfire.Core are installed by default.
                    </h5><br>
                    <h4><b>Setup Storage:
                        </b></h4>
                    <br>
                    <h5>Hangfire has the ability to use a SQL Server database by default for storing job definitions and
                        statuses. Additionally, you have the option to choose other alternatives. For our example
                        project, I have decided to use MSSQL local storage for simplicity.
                    </h5>
                    <br>
                    <h5>
                        It is essential to have a database definition, regardless of whether you use a local or remote
                        database. Hangfire is capable of creating the necessary tables for job storage, but it cannot
                        create a database. Therefore, you must provide a database.
                    </h5><br>
                    <h5>
                        Once you have set up our local database, you must update the appsettings.json file:
                    </h5>
                    <img src="/images/blog/newsletter10/appsettings-file.png"
                        style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                    <br>
                    <br>
                    <h4><b>Program.cs setup:</b></h4>
                    <br>
                    <h5>You need to add Hangfire to Services collection.
                    </h5>
                    <br>
                    <h5>You need to provide the connection string that you specified inside the appsettings.json file.
                    </h5>
                    <img src="/images/blog/newsletter10/add-hangfire.png"
                        style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                    <h5>
                        You also add the Hangfire server with the AddHangfireServer() method.
                    </h5>
                    <img src="/images/blog/newsletter10/add-hangfire-server.png"
                        style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                    <h5>
                        Lastly, you can add Hangfire Dashboard for easily monitoring servers and jobs.By calling the
                        UseHangfireDashboard() method you are adding it to popeline.
                    </h5>
                    <img src="/images/blog/newsletter10/user-hangfire-dashboard.png"
                        style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                    <br>
                    <br>
                    <h3 class="text-center mb-5" style="color: #ffbd39">Running the application
                    </h3>
                    <br>
                    <h4><b>Persistence:
                        </b></h4>
                    <br>
                    <h5>Hangfire will automatically check your storage for the necessary tables, and if they don’t
                        exist, it will create them for you:
                    </h5>
                    <img src="/images/blog/newsletter10/database.jpg"
                        style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                    <br>
                    <br>
                    <h4><b>Hangfire Dashboard:
                        </b></h4><br>
                    <h5>
                        This is a web-based UI that allows you to monitor the state of your background jobs. You can use
                        the dashboard to view the status of jobs, retry failed jobs, and cancel running jobs if
                        necessary. To check the dashboard you need to land on <b>/hangfire</b> page.
                    </h5>
                    <img src="/images/blog/newsletter10/hangfire-dashboard.png"
                        style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                    <br>
                    <br>
                    <h3 class="text-center mb-5" style="color: #ffbd39">Background jobs
                    </h3>
                    <br>
                    <h5>There are several types of background jobs that you can perform using Hangfire:
                    </h5>
                    <br>
                    <h5><b>- Fire-and-forget:</b>
                    </h5>
                    <br>
                    <h5>These are jobs that are executed once and then forgotten. They are used for tasks that need to
                        be performed in the background, but the result doesn't need to be returned to the application
                        immediately.
                    </h5>
                    <br>
                    <h5><b>- Delayed jobs:
                        </b>
                    </h5>
                    <br>
                    <h5>These are jobs that are scheduled to run at a specific time in the future. You can use them to
                        schedule tasks that need to be performed at a specific time, such as sending a reminder email to
                        a user.
                    </h5>
                    <br>
                    <h5><b>- Recurring jobs:
                        </b>
                    </h5>
                    <br>
                    <h5>These are jobs that are scheduled to run repeatedly at a specified interval. You can use them to
                        automate tasks that need to be performed on a regular basis, such as generating reports or
                        performing database cleanup.
                    </h5>
                    <br>
                    <h5><b>- Continuations
                        </b>
                    </h5>
                    <br>
                    <h5>These are jobs that are executed after a previous job has completed. You can use them to create
                        a sequence of jobs that need to be performed in a specific order.
                    </h5>
                    <br>
                    <h5><b>- Batch jobs:
                        </b>
                    </h5>
                    <br>
                    <h5>These are jobs that are grouped together and executed as a single unit. You can use them to
                        perform a set of related tasks that need to be executed together.
                    </h5>
                    <br>
                    <img src="/images/blog/newsletter10/ijobservice.png"
                        style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                 <br>
                 <br>
                    <h3 class="text-center mb-5" style="color: #ffbd39">Executing jobs
                    </h3>
                    <h4><b>Fire and Forget jobs
                    </b></h4>
                    <br>
                    <h5>We need to inject IBackgroundJobClient in order do call the job with Enqueue. 
                    </h5>
                    <br>
                    <h5>Enqueueing a job means that you are adding it to a queue of jobs that are waiting to be processed. When a job is enqueued, it is not executed immediately but instead is stored in a persistent storage (usually a database) until a worker process is available to process it.
                    </h5>
                    <br>
                    <h5>In order to test, you can create an endpoint:
                    </h5>
                    <img src="/images/blog/newsletter10/fire-and-forget-job.png"
                        style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                    <br>
                    <br>
                    <h4><b>Delayed jobs
                    </b></h4>
                    <br>
                    <h5>The Schedule method in the IBackgroundJobClient interface of the Hangfire library is used to schedule a job to run at a specific time in the future.
                    </h5>
                    <br>
                    <h5>When you schedule a job using the Schedule method, you are specifying a delay or a specific date and time for the job to run. The job is added to a persistent storage (usually a database) and is executed automatically when the specified time is reached.
                    </h5>
                    <br>
                    <h5>Let's create another endpoint:
                    </h5>
                    <img src="/images/blog/newsletter10/delayed-job.png"
                        style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                        <br>
                    <br>
                    <h4><b>Continuation jobs
                    </b></h4>
                    <br>
                    <h5>In other words, when you create a continuation job, you're saying <b>"once this other job is done, then run this one."</b> This can be useful for creating complex workflows where certain jobs need to run in a specific order, or where one job needs to finish before another can begin.
                    </h5>
                    <br>
                    <h5>To create a continuation job in Hangfire, you first need to create the parent job using one of the library's scheduling methods, such as Enqueue or Schedule. Then, you can use the Continuations API to create the dependent job that will run after the parent job is finished.
                    </h5>
                    <br>
                    <h5>Let's create another endpoint:
                    </h5>
                    <img src="/images/blog/newsletter10/continuation-job.png"
                        style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                        <br>
                        <br>
                        <h4><b>Reccuring  jobs
                        </b></h4>
                        <br>
                        <h5>To schedule this job you will need a different Hangfire interface. You need to inject <b>IRecurringJobManager</b>. 
                        </h5>
                        <br>
                        <h5>A recurring job is a task that needs to be performed repeatedly on a schedule. For example, sending a weekly email newsletter, or performing a daily database backup.
                        </h5>
                        <br>
                        <h5>Using Hangfire's AddOrUpdate method, you can define the schedule for a recurring job using a cron expression, which is a string that specifies the frequency and timing of the job.
                        </h5>
                        <br>
                        <h5>Here's how the AddOrUpdate method works: you first need to specify a unique identifier for the job, which will be used to identify it later. Then, you provide a lambda expression that defines the method to be executed as the job. Finally, you specify the cron expression that defines the job's schedule.
                        </h5>
                        <br>
                        <h5>Let's create another endpoint:
                        </h5>
                        <img src="/images/blog/newsletter10/reccuring-job.png"
                            style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                            <br>
                            <br>
                            <h4><b>Batch   jobs
                            </b></h4>
                            <br>
                            <h5>Batches allow you to create a bunch of background jobs atomically. This means that if there was an exception during the creation of background jobs, none of them will be processed.
                            </h5>
                            <img src="/images/blog/newsletter10/batch-job.png"
                                style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
                                <br>

                    <h3 class="text-center mb-5 mt-5" style="color: #ffbd39;margin-top: -40px;">What Next?</h3>
                    <h5>
                        Make a coffee and check the whole project implementation on my <a
                            href="https://github.com/StefanTheCode/Newsletter/tree/main/10%23%20-%20Hangfire" target="_blank"> GitHub repository</a>.
                    </h5>
                    <br>
                    <h5>
                        That's all from me for today. </h5>
                    <br>
                    <h3 class="text-center"><b>Dream <span style="font-size: 50px;">big!</span></b></h3>
                    <div class="row" style="margin-top: 50px">
                        <div class="col-md-3"></div>
                        <div class="col-md-6 text-center">
                            <h5 style="text-align: center; ">
                                Join the 3300+ engineers who get tips like this <span style="color: #ffbd39;">every Monday</span> straight to their inbox.
                            </h5>
                            <script async src="https://eocampaign1.com/form/33e483be-a0b1-11ed-b1bd-9b9d338510f2.js"
                                data-form="33e483be-a0b1-11ed-b1bd-9b9d338510f2"></script>
                        </div>
                    </div>
                    <hr style="background-color: white">
                    <h5 style="text-align: center; ">
                        Promote yourself or your business to 3300+ subscribers by <a href="https://stefandjokic.tech/stefans-newsletter-sponsorship-opportunity"> sponsoring this blog/newsletter</a>.
                    </h5>
                </div>
            </div>
        </div>
    </section>

    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.waypoints.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/main.js"></script>

</body>

</html>